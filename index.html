<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Управление Факультетами и Группами</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .week-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
            white-space: nowrap;
        }
        .week-badge.all {
            background-color: #d1d5db; /* gray-300 */
            color: #4b5563; /* gray-600 */
        }
        .week-badge.odd {
            background-color: #fca5a5; /* red-300 */
            color: #991b1b; /* red-800 */
        }
        .week-badge.even {
            background-color: #a5f3fc; /* cyan-300 */
            color: #0891b2; /* cyan-700 */
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 flex flex-col items-center">

    <div class="bg-white p-6 md:p-10 rounded-3xl shadow-2xl w-full max-w-2xl">
        
        <div class="flex justify-between items-center mb-6 border-b pb-4">
            <button id="backButton" class="text-gray-500 hover:text-gray-700 transition-colors duration-200 p-2 rounded-full hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <h1 id="pageTitle" class="text-3xl font-bold text-gray-900">Расписание</h1>
            <button id="showAdminButton" class="text-gray-500 hover:text-gray-700 transition-colors duration-200 p-2 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.527.272 1.092.427 1.724 1.066z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>
        </div>

        <div id="pagesContainer">
            
            <div id="schedule_page" class="page active">
                <div class="mb-4 space-y-4">
                    <div class="space-y-2">
                        <label for="facultyFilter" class="block text-sm font-medium text-gray-700">Факультет:</label>
                        <select id="facultyFilter" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500"></select>
                    </div>
                    <div class="space-y-2">
                        <label for="groupFilter" class="block text-sm font-medium text-gray-700">Группа:</label>
                        <select id="groupFilter" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500"></select>
                    </div>
                    <div class="space-y-2">
                        <label for="dayFilter" class="block text-sm font-medium text-gray-700">День:</label>
                        <select id="dayFilter" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500">
                            <option value="all">Вся неделя</option>
                            <option value="today">Сегодня</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label for="weekTypeFilter" class="block text-sm font-medium text-gray-700">Тип недели:</label>
                        <select id="weekTypeFilter" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500">
                            <option value="all">Все</option>
                            <option value="even">Четная</option>
                            <option value="odd">Нечетная</option>
                        </select>
                    </div>
                </div>
                <div id="scheduleList" class="space-y-6">
                    <div class="flex items-center justify-center p-8">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <div id="password_page" class="page">
                <div class="space-y-4">
                    <p class="text-gray-600 mb-6">Введите пароль для доступа к панели администратора.</p>
                    <input id="adminPasswordInput" type="password" placeholder="Пароль" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500">
                    <button id="submitPasswordButton" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-blue-700 transition-colors duration-200 shadow-md">
                        Войти
                    </button>
                </div>
            </div>

            <div id="admin_page" class="page">
                <p class="text-gray-600 mb-6">Панель администрирования. Здесь вы можете управлять данными.</p>
                <div class="space-y-4">
                    <button id="showFacultiesButton" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-blue-700 transition-colors duration-200 shadow-md">
                        Управление факультетами
                    </button>
                    <button id="showGroupsButton" class="w-full bg-green-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-green-700 transition-colors duration-200 shadow-md">
                        Управление группами
                    </button>
                    <button id="showScheduleAdminButton" class="w-full bg-indigo-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-indigo-700 transition-colors duration-200 shadow-md">
                        Управление расписанием
                    </button>
                </div>
            </div>

            <div id="schedule_admin_page" class="page">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Редактирование расписания</h2>
                    <button id="addScheduleEntryButton" class="bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-colors duration-200 shadow-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2 mb-4">
                    <label for="groupSelect" class="block text-sm font-medium text-gray-700">Выберите группу:</label>
                    <select id="groupSelect" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500"></select>
                </div>
                <div id="scheduleAdminList" class="space-y-6">
                    <p class="text-gray-500 text-center text-sm">Пожалуйста, выберите группу.</p>
                </div>
            </div>

            <div id="faculties_page" class="page">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Список факультетов</h2>
                    <button id="addFacultyButton" class="bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-colors duration-200 shadow-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                    </button>
                </div>
                <div id="facultiesList" class="space-y-4">
                    <p class="text-gray-500 text-center text-sm">Нет доступных факультетов.</p>
                </div>
            </div>

            <div id="groups_page" class="page">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Список групп</h2>
                    <button id="addGroupButton" class="bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-colors duration-200 shadow-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                    </button>
                </div>
                <div id="groupsList" class="space-y-4">
                    <p class="text-gray-500 text-center text-sm">Нет доступных групп.</p>
                </div>
            </div>

            <div id="faculty_edit_page" class="page">
                <h2 id="facultyFormTitle" class="text-2xl font-semibold text-gray-800 mb-4"></h2>
                <input id="facultyNameInput" type="text" placeholder="Название факультета" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 mb-4">
                <button id="saveFacultyButton" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-blue-700 transition-colors duration-200 shadow-md">
                    Сохранить
                </button>

                <div id="facultyGroupsSection" class="mt-8 pt-4 border-t border-gray-200 hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">Группы факультета</h3>
                        <button id="addGroupsToFacultyButton" class="bg-green-500 text-white p-2 rounded-full hover:bg-green-600 transition-colors duration-200 shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                        </button>
                    </div>
                    <div id="facultyGroupsList" class="space-y-2"></div>
                </div>
            </div>

            <div id="group_edit_page" class="page">
                <h2 id="groupFormTitle" class="text-2xl font-semibold text-gray-800 mb-4"></h2>
                <select id="groupFacultySelect" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500">
                    <option value="">Выберите факультет</option>
                </select>
                <input id="groupNameInput" type="text" placeholder="Название группы" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 mb-4">
                <button id="saveGroupButton" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-blue-700 transition-colors duration-200 shadow-md">
                    Сохранить
                </button>
            </div>
            
            <div id="addGroupsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
                <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-xl bg-white">
                    <div class="mt-3 text-center">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Добавить группы</h3>
                        <div class="mt-2 px-7 py-3">
                            <div id="availableGroupsList" class="space-y-2"></div>
                        </div>
                        <div class="items-center px-4 py-3">
                            <button id="closeModalButton" class="px-4 py-2 bg-gray-200 text-gray-700 text-base font-medium rounded-xl hover:bg-gray-300 transition-colors duration-200 w-full">
                                Закрыть
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="scheduleModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
                <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-xl bg-white">
                    <div class="mt-3 text-center">
                        <h3 id="scheduleModalTitle" class="text-lg leading-6 font-medium text-gray-900">Добавить занятие</h3>
                        <div class="mt-2 px-7 py-3 space-y-4">
                            <select id="scheduleDayInput" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500">
                                <option value="Понедельник">Понедельник</option>
                                <option value="Вторник">Вторник</option>
                                <option value="Среда">Среда</option>
                                <option value="Четверг">Четверг</option>
                                <option value="Пятница">Пятница</option>
                                <option value="Суббота">Суббота</option>
                                <option value="Воскресенье">Воскресенье</option>
                            </select>
                            <input id="scheduleTimeInput" type="time" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500">
                            <input id="scheduleSubjectInput" type="text" placeholder="Название предмета" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500">
                            <select id="scheduleWeekTypeInput" class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500">
                                <option value="all">Для всех недель</option>
                                <option value="even">Четная неделя</option>
                                <option value="odd">Нечетная неделя</option>
                            </select>
                        </div>
                        <div class="items-center px-4 py-3">
                            <button id="saveScheduleEntryButton" class="px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-xl hover:bg-blue-700 transition-colors duration-200 w-full mb-2">
                                Сохранить
                            </button>
                            <button id="closeScheduleModalButton" class="px-4 py-2 bg-gray-200 text-gray-700 text-base font-medium rounded-xl hover:bg-gray-300 transition-colors duration-200 w-full">
                                Отмена
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="messageBox" class="mt-8 p-4 rounded-xl text-center font-medium transition-opacity duration-300 opacity-0"></div>

    </div>

    <script type="module">
        // Глобальные переменные, предоставляемые средой Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "firebase/app";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyB2kuT1fSPp4kBKeEad_rYXMqh27z2KDO0",
          authDomain: "raspisanie-c90b6.firebaseapp.com",
          projectId: "raspisanie-c90b6",
          storageBucket: "raspisanie-c90b6.firebasestorage.app",
          messagingSenderId: "867699750609",
          appId: "1:867699750609:web:6cbf1c0c8bfa429b0337f0"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- FIREBASE ИМПОРТЫ ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, setDoc, deleteDoc, addDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- ДАННЫЕ И СОСТОЯНИЕ ---
        let faculties = [];
        let groups = [];
        let schedule = [];
        let db;
        let auth;
        let userId;

        // --- СОСТОЯНИЕ НАВИГАЦИИ ---
        const pageHistory = ['schedule_page'];
        const pageTitle = document.getElementById('pageTitle');
        
        // --- DOM ЭЛЕМЕНТЫ ---
        const pages = document.querySelectorAll('.page');
        const showAdminButton = document.getElementById('showAdminButton');
        const backButton = document.getElementById('backButton');
        const facultiesList = document.getElementById('facultiesList');
        const groupsList = document.getElementById('groupsList');
        const scheduleList = document.getElementById('scheduleList');
        const facultyFilter = document.getElementById('facultyFilter');
        const groupFilter = document.getElementById('groupFilter');
        const dayFilter = document.getElementById('dayFilter');
        const weekTypeFilter = document.getElementById('weekTypeFilter');
        const facultyNameInput = document.getElementById('facultyNameInput');
        const groupNameInput = document.getElementById('groupNameInput');
        const groupFacultySelect = document.getElementById('groupFacultySelect');
        const facultyGroupsSection = document.getElementById('facultyGroupsSection');
        const facultyGroupsList = document.getElementById('facultyGroupsList');
        const addGroupsModal = document.getElementById('addGroupsModal');
        const availableGroupsList = document.getElementById('availableGroupsList');
        const adminPasswordInput = document.getElementById('adminPasswordInput');
        const messageBox = document.getElementById('messageBox');
        
        // Элементы админ-панели
        const showFacultiesButton = document.getElementById('showFacultiesButton');
        const showGroupsButton = document.getElementById('showGroupsButton');
        const showScheduleAdminButton = document.getElementById('showScheduleAdminButton');
        const addFacultyButton = document.getElementById('addFacultyButton');
        const addGroupButton = document.getElementById('addGroupButton');
        const addGroupsToFacultyButton = document.getElementById('addGroupsToFacultyButton');
        const saveFacultyButton = document.getElementById('saveFacultyButton');
        const saveGroupButton = document.getElementById('saveGroupButton');
        const closeModalButton = document.getElementById('closeModalButton');
        const submitPasswordButton = document.getElementById('submitPasswordButton');

        // Элементы админ-панели расписания
        const groupSelect = document.getElementById('groupSelect');
        const scheduleAdminList = document.getElementById('scheduleAdminList');
        const addScheduleEntryButton = document.getElementById('addScheduleEntryButton');
        const scheduleModal = document.getElementById('scheduleModal');
        const scheduleModalTitle = document.getElementById('scheduleModalTitle');
        const scheduleDayInput = document.getElementById('scheduleDayInput');
        const scheduleTimeInput = document.getElementById('scheduleTimeInput');
        const scheduleSubjectInput = document.getElementById('scheduleSubjectInput');
        const scheduleWeekTypeInput = document.getElementById('scheduleWeekTypeInput');
        const saveScheduleEntryButton = document.getElementById('saveScheduleEntryButton');
        const closeScheduleModalButton = document.getElementById('closeScheduleModalButton');

        // Текущее состояние для редактирования
        let currentFacultyId = null;
        let currentGroupId = null;
        let currentScheduleEntryId = null;

        // --- ИНТЕГРАЦИЯ С TELEGRAM WEB APP ---
        const WebApp = window.Telegram.WebApp;
        WebApp.ready();
        WebApp.onEvent('backButtonClicked', goBack);

        // --- ФУНКЦИИ ИНИЦИАЛИЗАЦИИ ---

        /**
         * Инициализирует Firebase и настраивает слушателей данных.
         */
        async function initializeAppAndAuth() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    throw new Error("Firebase config is missing.");
                }

                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Используем onAuthStateChanged для отслеживания состояния аутентификации
                // Это гарантирует, что мы получим пользователя, прежде чем начнем работать с Firestore.
                // onAuthStateChanged вызывается один раз при загрузке, а затем при каждом изменении состояния.
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        userId = user.uid;
                        // После успешного входа начинаем прослушивать данные
                        setupFirestoreListeners();
                    } else {
                        // Если токен отсутствует, входим анонимно
                        await signInAnonymously(auth);
                    }
                });

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Ошибка инициализации Firebase:", error);
                showMessage("Ошибка инициализации приложения.", "error");
            }
        }

        /**
         * Настраивает слушателей для коллекций Firestore.
         */
        function setupFirestoreListeners() {
            const facultyCollectionRef = collection(db, `artifacts/${appId}/public/data/faculties`);
            const groupCollectionRef = collection(db, `artifacts/${appId}/public/data/groups`);
            const scheduleCollectionRef = collection(db, `artifacts/${appId}/public/data/schedule`);

            onSnapshot(facultyCollectionRef, (snapshot) => {
                faculties = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderFaculties();
                renderGroupFacultySelect();
                renderFacultyAndGroupFilters();
            });

            onSnapshot(groupCollectionRef, (snapshot) => {
                groups = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderGroups();
                renderAvailableGroups();
                renderGroupSelect();
                renderFacultyAndGroupFilters();
            });

            onSnapshot(scheduleCollectionRef, (snapshot) => {
                schedule = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderSchedule();
                renderScheduleAdminList();
            });
        }

        // --- ФУНКЦИИ НАВИГАЦИИ ---

        /**
         * Отображает указанную страницу и управляет историей навигации.
         * @param {string} pageId Идентификатор страницы для отображения.
         */
        function showPage(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            if (pageHistory[pageHistory.length - 1] !== pageId) {
                pageHistory.push(pageId);
            }
            
            updateNavigationUI();
        }

        /**
         * Возвращается к предыдущей странице в истории.
         */
        function goBack() {
            if (pageHistory.length > 1) {
                pageHistory.pop();
                const lastPageId = pageHistory[pageHistory.length - 1];
                pages.forEach(page => page.classList.remove('active'));
                const targetPage = document.getElementById(lastPageId);
                if (targetPage) {
                    targetPage.classList.add('active');
                }
                updateNavigationUI();
            } else {
                WebApp.close();
            }
        }

        /**
         * Обновляет элементы управления навигацией (кнопка "Назад" и заголовок страницы).
         */
        function updateNavigationUI() {
            if (pageHistory.length > 1) {
                WebApp.BackButton.show();
                showAdminButton.classList.add('hidden');
                backButton.classList.remove('hidden');
            } else {
                WebApp.BackButton.hide();
                showAdminButton.classList.remove('hidden');
                backButton.classList.add('hidden');
            }

            const currentPage = pageHistory[pageHistory.length - 1];
            switch (currentPage) {
                case 'schedule_page': pageTitle.textContent = 'Расписание'; break;
                case 'password_page': pageTitle.textContent = 'Вход'; break;
                case 'admin_page': pageTitle.textContent = 'Администрирование'; break;
                case 'faculties_page': pageTitle.textContent = 'Факультеты'; renderFaculties(); break;
                case 'groups_page': pageTitle.textContent = 'Группы'; renderGroups(); break;
                case 'schedule_admin_page': pageTitle.textContent = 'Редактирование расписания'; renderGroupSelect(); renderScheduleAdminList(); break;
                case 'faculty_edit_page': pageTitle.textContent = 'Редактирование факультета'; break;
                case 'group_edit_page': pageTitle.textContent = 'Редактирование группы'; break;
                default: pageTitle.textContent = 'Страница';
            }
        }
        
        /**
         * Отображает временное сообщение в нижней части экрана.
         * @param {string} message Текст сообщения.
         * @param {string} type Тип сообщения ('success' или 'error').
         */
        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.classList.remove('opacity-0', 'bg-red-200', 'text-red-800', 'bg-green-200', 'text-green-800');
            if (type === 'success') {
                messageBox.classList.add('bg-green-200', 'text-green-800');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-200', 'text-red-800');
            }
            messageBox.classList.add('opacity-100');
            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
            }, 3000);
        }

        // --- РЕНДЕРИНГ ЭЛЕМЕНТОВ ---

        /**
         * Рендерит список факультетов.
         */
        function renderFaculties() {
            facultiesList.innerHTML = '';
            if (faculties.length === 0) {
                facultiesList.innerHTML = `<p class="text-gray-500 text-center text-sm">Нет доступных факультетов.</p>`;
                return;
            }
            faculties.forEach(faculty => {
                const facultyGroupsCount = groups.filter(g => g.facultyId === faculty.id).length;
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between bg-gray-50 p-4 rounded-xl shadow-sm';
                item.innerHTML = `
                    <div>
                        <h3 class="font-semibold text-gray-900">${faculty.name}</h3>
                        <p class="text-sm text-gray-500">${facultyGroupsCount} групп(а)</p>
                    </div>
                    <div>
                        <button class="edit-btn text-blue-500 hover:text-blue-700 font-medium transition-colors duration-200 mr-2" data-id="${faculty.id}">Редактировать</button>
                        <button class="delete-btn text-red-500 hover:text-red-700 font-medium transition-colors duration-200" data-id="${faculty.id}">Удалить</button>
                    </div>
                `;
                facultiesList.appendChild(item);
            });
        }

        /**
         * Рендерит список групп.
         */
        function renderGroups() {
            groupsList.innerHTML = '';
            if (groups.length === 0) {
                groupsList.innerHTML = `<p class="text-gray-500 text-center text-sm">Нет доступных групп.</p>`;
                return;
            }
            groups.forEach(group => {
                const faculty = faculties.find(f => f.id === group.facultyId);
                const facultyName = faculty ? faculty.name : 'Без факультета';
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between bg-gray-50 p-4 rounded-xl shadow-sm';
                item.innerHTML = `
                    <div>
                        <h3 class="font-semibold text-gray-900">${group.name}</h3>
                        <p class="text-sm text-gray-500">${facultyName}</p>
                    </div>
                    <div>
                        <button class="edit-btn text-blue-500 hover:text-blue-700 font-medium transition-colors duration-200 mr-2" data-id="${group.id}">Редактировать</button>
                        <button class="delete-btn text-red-500 hover:text-red-700 font-medium transition-colors duration-200" data-id="${group.id}">Удалить</button>
                    </div>
                `;
                groupsList.appendChild(item);
            });
        }

        /**
         * Рендерит выпадающий список факультетов для редактирования группы.
         */
        function renderGroupFacultySelect() {
            groupFacultySelect.innerHTML = '<option value="">Выберите факультет</option>';
            faculties.forEach(faculty => {
                const option = document.createElement('option');
                option.value = faculty.id;
                option.textContent = faculty.name;
                groupFacultySelect.appendChild(option);
            });
        }

        /**
         * Рендерит список групп, привязанных к факультету.
         * @param {string} facultyId Идентификатор факультета.
         */
        function renderFacultyGroups(facultyId) {
            facultyGroupsList.innerHTML = '';
            const facultyGroups = groups.filter(g => g.facultyId === facultyId);
            if (facultyGroups.length === 0) {
                facultyGroupsList.innerHTML = `<p class="text-gray-500 text-sm">В этом факультете пока нет групп.</p>`;
            }
            facultyGroups.forEach(group => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between bg-white p-3 rounded-lg border border-gray-200';
                item.innerHTML = `
                    <span class="text-gray-800">${group.name}</span>
                    <button class="remove-group-btn text-red-500 hover:text-red-700 text-sm font-medium transition-colors duration-200" data-group-id="${group.id}">Убрать</button>
                `;
                facultyGroupsList.appendChild(item);
            });
        }

        /**
         * Рендерит список доступных групп для добавления к факультету.
         */
        function renderAvailableGroups() {
            availableGroupsList.innerHTML = '';
            const availableGroups = groups.filter(g => !g.facultyId);
            if (availableGroups.length === 0) {
                availableGroupsList.innerHTML = `<p class="text-gray-500 text-sm">Все группы уже привязаны к факультетам.</p>`;
            }
            availableGroups.forEach(group => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200';
                item.innerHTML = `
                    <span class="text-gray-800">${group.name}</span>
                    <button class="add-group-btn bg-green-500 text-white text-sm font-medium py-1 px-3 rounded-lg hover:bg-green-600 transition-colors duration-200" data-group-id="${group.id}">Добавить</button>
                `;
                availableGroupsList.appendChild(item);
            });
        }

        /**
         * Рендерит выпадающие списки для фильтрации расписания.
         */
        function renderFacultyAndGroupFilters() {
            // Рендерим фильтр факультетов
            const currentFacultyValue = facultyFilter.value;
            facultyFilter.innerHTML = '<option value="all">Все факультеты</option>';
            faculties.forEach(faculty => {
                const option = document.createElement('option');
                option.value = faculty.id;
                option.textContent = faculty.name;
                facultyFilter.appendChild(option);
            });
            facultyFilter.value = currentFacultyValue;

            // Рендерим фильтр групп на основе выбранного факультета
            const selectedFacultyId = facultyFilter.value === 'all' ? null : facultyFilter.value;
            const currentGroupValue = groupFilter.value;
            groupFilter.innerHTML = '<option value="all">Выберите группу</option>';
            const filteredGroups = selectedFacultyId ? groups.filter(g => g.facultyId === selectedFacultyId) : groups;
            filteredGroups.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = group.name;
                groupFilter.appendChild(option);
            });
            groupFilter.value = currentGroupValue;
        }

        /**
         * Рендерит расписание для выбранной группы с учетом фильтров.
         */
        function renderSchedule() {
            scheduleList.innerHTML = '';
            const selectedGroupId = groupFilter.value === 'all' ? null : groupFilter.value;
            const dayFilterValue = dayFilter.value;
            const weekTypeFilterValue = weekTypeFilter.value;
            const daysOfWeek = ['Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота', 'Воскресенье'];
            
            if (!selectedGroupId) {
                scheduleList.innerHTML = `<p class="text-gray-500 text-center text-sm">Пожалуйста, выберите факультет и группу для просмотра расписания.</p>`;
                return;
            }

            const selectedGroup = groups.find(g => g.id === selectedGroupId);
            let filteredSchedule = [];

            if (selectedGroup) {
                filteredSchedule = schedule.filter(item => item.group === selectedGroup.name);
            }

            if (dayFilterValue === 'today') {
                const today = new Date().getDay();
                const todayName = daysOfWeek[today - 1]; // getDay() returns 0 for Sunday
                filteredSchedule = filteredSchedule.filter(item => item.day === todayName);
            }

            if (weekTypeFilterValue !== 'all') {
                filteredSchedule = filteredSchedule.filter(item => item.weekType === weekTypeFilterValue || item.weekType === 'all');
            }

            filteredSchedule.sort((a, b) => {
                const dayA = daysOfWeek.indexOf(a.day);
                const dayB = daysOfWeek.indexOf(b.day);
                if (dayA !== dayB) {
                    return dayA - dayB;
                }
                const timeA = a.time.split(':').map(Number);
                const timeB = b.time.split(':').map(Number);
                if (timeA[0] !== timeB[0]) {
                    return timeA[0] - timeB[0];
                }
                return timeA[1] - timeB[1];
            });

            if (filteredSchedule.length === 0) {
                scheduleList.innerHTML = `<p class="text-gray-500 text-center text-sm">Расписание не найдено.</p>`;
                return;
            }

            let currentDay = '';
            filteredSchedule.forEach(item => {
                if (item.day !== currentDay) {
                    const dayHeader = document.createElement('h3');
                    dayHeader.className = 'text-xl font-semibold text-gray-800 mt-4 mb-2 first:mt-0';
                    dayHeader.textContent = item.day;
                    scheduleList.appendChild(dayHeader);
                    currentDay = item.day;
                }
                const badgeClass = item.weekType === 'odd' ? 'odd' : item.weekType === 'even' ? 'even' : 'all';
                const badgeText = item.weekType === 'odd' ? 'Нечетная' : item.weekType === 'even' ? 'Четная' : 'Все недели';
                const itemHTML = `
                    <div class="bg-gray-50 p-4 rounded-xl shadow-sm flex items-center justify-between">
                        <div>
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="font-semibold text-gray-900">${item.time}</span>
                                <span class="week-badge ${badgeClass}">${badgeText}</span>
                            </div>
                            <p class="text-sm text-gray-700">${item.subject}</p>
                        </div>
                    </div>
                `;
                scheduleList.insertAdjacentHTML('beforeend', itemHTML);
            });
        }
        
        /**
         * Рендерит выпадающий список групп для админ-панели расписания.
         */
        function renderGroupSelect() {
            groupSelect.innerHTML = '<option value="">Выберите группу</option>';
            groups.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = group.name;
                groupSelect.appendChild(option);
            });
        }

        /**
         * Рендерит список расписания для админ-панели выбранной группы.
         */
        function renderScheduleAdminList() {
            const selectedGroupId = groupSelect.value;
            const selectedGroup = groups.find(g => g.id === selectedGroupId);
            scheduleAdminList.innerHTML = '';
            if (!selectedGroup) {
                scheduleAdminList.innerHTML = `<p class="text-gray-500 text-center text-sm">Пожалуйста, выберите группу.</p>`;
                return;
            }

            const filteredSchedule = schedule.filter(item => item.group === selectedGroup.name);
            const daysOfWeek = ['Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота', 'Воскресенье'];
            filteredSchedule.sort((a, b) => {
                const dayA = daysOfWeek.indexOf(a.day);
                const dayB = daysOfWeek.indexOf(b.day);
                if (dayA !== dayB) {
                    return dayA - dayB;
                }
                const timeA = a.time.split(':').map(Number);
                const timeB = b.time.split(':').map(Number);
                if (timeA[0] !== timeB[0]) {
                    return timeA[0] - timeB[0];
                }
                return timeA[1] - timeB[1];
            });

            if (filteredSchedule.length === 0) {
                scheduleAdminList.innerHTML = `<p class="text-gray-500 text-center text-sm">В этой группе пока нет расписания.</p>`;
                return;
            }
            
            let currentDay = '';
            filteredSchedule.forEach(item => {
                if (item.day !== currentDay) {
                    const dayHeader = document.createElement('h3');
                    dayHeader.className = 'text-xl font-semibold text-gray-800 mt-4 mb-2 first:mt-0';
                    dayHeader.textContent = item.day;
                    scheduleAdminList.appendChild(dayHeader);
                    currentDay = item.day;
                }

                const badgeClass = item.weekType === 'odd' ? 'odd' : item.weekType === 'even' ? 'even' : 'all';
                const badgeText = item.weekType === 'odd' ? 'Нечетная' : item.weekType === 'even' ? 'Четная' : 'Все недели';
                const itemHTML = `
                    <div class="bg-gray-50 p-4 rounded-xl shadow-sm flex items-center justify-between">
                        <div>
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="font-semibold text-gray-900">${item.time}</span>
                                <span class="week-badge ${badgeClass}">${badgeText}</span>
                            </div>
                            <p class="text-sm text-gray-700">${item.subject}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button class="edit-schedule-btn text-blue-500 hover:text-blue-700" data-id="${item.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                                    <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button class="delete-schedule-btn text-red-500 hover:text-red-700" data-id="${item.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                scheduleAdminList.insertAdjacentHTML('beforeend', itemHTML);
            });
        }

        // --- ФУНКЦИИ УПРАВЛЕНИЯ ДАННЫМИ ---

        /**
         * Сохраняет или обновляет факультет в Firestore.
         */
        async function saveFaculty() {
            const facultyName = facultyNameInput.value.trim();
            if (!facultyName) {
                showMessage('Название факультета не может быть пустым.', 'error');
                return;
            }

            try {
                if (currentFacultyId) {
                    const facultyRef = doc(db, `artifacts/${appId}/public/data/faculties`, currentFacultyId);
                    await setDoc(facultyRef, { name: facultyName }, { merge: true });
                    showMessage('Факультет успешно обновлен!', 'success');
                } else {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/faculties`), { name: facultyName });
                    showMessage('Факультет успешно добавлен!', 'success');
                }
                showPage('faculties_page');
            } catch (error) {
                console.error("Ошибка сохранения факультета:", error);
                showMessage('Не удалось сохранить факультет.', 'error');
            }
        }

        /**
         * Удаляет факультет.
         * @param {string} facultyId Идентификатор факультета для удаления.
         */
        async function deleteFaculty(facultyId) {
            try {
                // Отвязываем группы от этого факультета
                const facultyGroups = groups.filter(g => g.facultyId === facultyId);
                const batch = [];
                facultyGroups.forEach(group => {
                    const groupRef = doc(db, `artifacts/${appId}/public/data/groups`, group.id);
                    batch.push(updateDoc(groupRef, { facultyId: null }));
                });
                await Promise.all(batch);

                await deleteDoc(doc(db, `artifacts/${appId}/public/data/faculties`, facultyId));
                showMessage('Факультет и связанные с ним группы успешно удалены!', 'success');
            } catch (error) {
                console.error("Ошибка удаления факультета:", error);
                showMessage('Не удалось удалить факультет.', 'error');
            }
        }

        /**
         * Сохраняет или обновляет группу.
         */
        async function saveGroup() {
            const groupName = groupNameInput.value.trim();
            const facultyId = groupFacultySelect.value || null;
            if (!groupName) {
                showMessage('Название группы не может быть пустым.', 'error');
                return;
            }

            try {
                const groupData = { name: groupName, facultyId: facultyId };
                if (currentGroupId) {
                    const groupRef = doc(db, `artifacts/${appId}/public/data/groups`, currentGroupId);
                    await setDoc(groupRef, groupData, { merge: true });
                    showMessage('Группа успешно обновлена!', 'success');
                } else {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/groups`), groupData);
                    showMessage('Группа успешно добавлена!', 'success');
                }
                showPage('groups_page');
            } catch (error) {
                console.error("Ошибка сохранения группы:", error);
                showMessage('Не удалось сохранить группу.', 'error');
            }
        }

        /**
         * Удаляет группу.
         * @param {string} groupId Идентификатор группы для удаления.
         */
        async function deleteGroup(groupId) {
            try {
                // Удаляем расписание, связанное с этой группой
                const group = groups.find(g => g.id === groupId);
                if (group) {
                    const groupSchedule = schedule.filter(s => s.group === group.name);
                    const batch = [];
                    groupSchedule.forEach(item => {
                        const scheduleRef = doc(db, `artifacts/${appId}/public/data/schedule`, item.id);
                        batch.push(deleteDoc(scheduleRef));
                    });
                    await Promise.all(batch);
                }

                await deleteDoc(doc(db, `artifacts/${appId}/public/data/groups`, groupId));
                showMessage('Группа и ее расписание успешно удалены!', 'success');
            } catch (error) {
                console.error("Ошибка удаления группы:", error);
                showMessage('Не удалось удалить группу.', 'error');
            }
        }

        /**
         * Сохраняет или обновляет запись расписания.
         */
        async function saveScheduleEntry() {
            const selectedGroup = groups.find(g => g.id === groupSelect.value);
            if (!selectedGroup) {
                showMessage('Сначала выберите группу.', 'error');
                return;
            }

            const scheduleData = {
                group: selectedGroup.name,
                day: scheduleDayInput.value,
                time: scheduleTimeInput.value,
                subject: scheduleSubjectInput.value.trim(),
                weekType: scheduleWeekTypeInput.value
            };

            if (!scheduleData.subject) {
                showMessage('Название предмета не может быть пустым.', 'error');
                return;
            }

            try {
                if (currentScheduleEntryId) {
                    const scheduleRef = doc(db, `artifacts/${appId}/public/data/schedule`, currentScheduleEntryId);
                    await setDoc(scheduleRef, scheduleData, { merge: true });
                    showMessage('Запись расписания успешно обновлена!', 'success');
                } else {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/schedule`), scheduleData);
                    showMessage('Запись расписания успешно добавлена!', 'success');
                }
                scheduleModal.classList.add('hidden');
                renderScheduleAdminList();
            } catch (error) {
                console.error("Ошибка сохранения расписания:", error);
                showMessage('Не удалось сохранить расписание.', 'error');
            }
        }

        /**
         * Удаляет запись расписания.
         * @param {string} scheduleId Идентификатор записи для удаления.
         */
        async function deleteScheduleEntry(scheduleId) {
            try {
                await deleteDoc(doc(db, `artifacts/${appId}/public/data/schedule`, scheduleId));
                showMessage('Запись расписания успешно удалена!', 'success');
            } catch (error) {
                console.error("Ошибка удаления расписания:", error);
                showMessage('Не удалось удалить расписание.', 'error');
            }
        }

        // --- ОБРАБОТЧИКИ СОБЫТИЙ ---

        document.addEventListener('DOMContentLoaded', initializeAppAndAuth);

        showAdminButton.addEventListener('click', () => {
            showPage('admin_page');
        });

        backButton.addEventListener('click', goBack);

        showFacultiesButton.addEventListener('click', () => showPage('faculties_page'));
        showGroupsButton.addEventListener('click', () => showPage('groups_page'));
        showScheduleAdminButton.addEventListener('click', () => showPage('schedule_admin_page'));

        addFacultyButton.addEventListener('click', () => {
            currentFacultyId = null;
            document.getElementById('facultyFormTitle').textContent = 'Добавить факультет';
            facultyNameInput.value = '';
            facultyGroupsSection.classList.add('hidden');
            showPage('faculty_edit_page');
        });

        addGroupButton.addEventListener('click', () => {
            currentGroupId = null;
            document.getElementById('groupFormTitle').textContent = 'Добавить группу';
            groupNameInput.value = '';
            groupFacultySelect.value = '';
            showPage('group_edit_page');
        });

        addGroupsToFacultyButton.addEventListener('click', () => {
            renderAvailableGroups();
            addGroupsModal.classList.remove('hidden');
        });

        closeModalButton.addEventListener('click', () => {
            addGroupsModal.classList.add('hidden');
        });

        addScheduleEntryButton.addEventListener('click', () => {
            currentScheduleEntryId = null;
            scheduleModalTitle.textContent = 'Добавить занятие';
            scheduleDayInput.value = 'Понедельник';
            scheduleTimeInput.value = '';
            scheduleSubjectInput.value = '';
            scheduleWeekTypeInput.value = 'all';
            scheduleModal.classList.remove('hidden');
        });

        closeScheduleModalButton.addEventListener('click', () => {
            scheduleModal.classList.add('hidden');
        });

        // Слушатели для списков
        document.addEventListener('click', async (e) => {
            if (e.target.closest('.edit-btn') && e.target.closest('#facultiesList')) {
                const id = e.target.closest('.edit-btn').dataset.id;
                const faculty = faculties.find(f => f.id === id);
                if (faculty) {
                    currentFacultyId = id;
                    document.getElementById('facultyFormTitle').textContent = 'Редактировать факультет';
                    facultyNameInput.value = faculty.name;
                    facultyGroupsSection.classList.remove('hidden');
                    renderFacultyGroups(id);
                    showPage('faculty_edit_page');
                }
            } else if (e.target.closest('.delete-btn') && e.target.closest('#facultiesList')) {
                const id = e.target.closest('.delete-btn').dataset.id;
                await deleteFaculty(id);
            } else if (e.target.closest('.edit-btn') && e.target.closest('#groupsList')) {
                const id = e.target.closest('.edit-btn').dataset.id;
                const group = groups.find(g => g.id === id);
                if (group) {
                    currentGroupId = id;
                    document.getElementById('groupFormTitle').textContent = 'Редактировать группу';
                    groupNameInput.value = group.name;
                    groupFacultySelect.value = group.facultyId || '';
                    showPage('group_edit_page');
                }
            } else if (e.target.closest('.delete-btn') && e.target.closest('#groupsList')) {
                const id = e.target.closest('.delete-btn').dataset.id;
                await deleteGroup(id);
            } else if (e.target.closest('.add-group-btn')) {
                const groupId = e.target.closest('.add-group-btn').dataset.groupId;
                try {
                    const groupRef = doc(db, `artifacts/${appId}/public/data/groups`, groupId);
                    await updateDoc(groupRef, { facultyId: currentFacultyId });
                    showMessage('Группа успешно добавлена к факультету!', 'success');
                    renderFacultyGroups(currentFacultyId);
                    addGroupsModal.classList.add('hidden');
                } catch (error) {
                    console.error("Ошибка добавления группы к факультету:", error);
                    showMessage('Не удалось добавить группу.', 'error');
                }
            } else if (e.target.closest('.remove-group-btn')) {
                const groupId = e.target.closest('.remove-group-btn').dataset.groupId;
                try {
                    const groupRef = doc(db, `artifacts/${appId}/public/data/groups`, groupId);
                    await updateDoc(groupRef, { facultyId: null });
                    showMessage('Группа успешно отвязана от факультета.', 'success');
                    renderFacultyGroups(currentFacultyId);
                } catch (error) {
                    console.error("Ошибка удаления группы:", error);
                    showMessage('Не удалось отвязать группу.', 'error');
                }
            } else if (e.target.closest('.edit-schedule-btn')) {
                const id = e.target.closest('.edit-schedule-btn').dataset.id;
                const entry = schedule.find(s => s.id === id);
                if (entry) {
                    currentScheduleEntryId = id;
                    scheduleModalTitle.textContent = 'Редактировать занятие';
                    scheduleDayInput.value = entry.day;
                    scheduleTimeInput.value = entry.time;
                    scheduleSubjectInput.value = entry.subject;
                    scheduleWeekTypeInput.value = entry.weekType;
                    scheduleModal.classList.remove('hidden');
                }
            } else if (e.target.closest('.delete-schedule-btn')) {
                const id = e.target.closest('.delete-schedule-btn').dataset.id;
                await deleteScheduleEntry(id);
            }
        });

        saveFacultyButton.addEventListener('click', saveFaculty);
        saveGroupButton.addEventListener('click', saveGroup);
        saveScheduleEntryButton.addEventListener('click', saveScheduleEntry);
        
        // Обработчики для фильтров
        facultyFilter.addEventListener('change', () => {
            renderFacultyAndGroupFilters();
            renderSchedule();
        });
        groupFilter.addEventListener('change', renderSchedule);
        dayFilter.addEventListener('change', renderSchedule);
        weekTypeFilter.addEventListener('change', renderSchedule);
        
        // Обработчик для выбора группы в админ-панели расписания
        groupSelect.addEventListener('change', renderScheduleAdminList);

        // Вход в админ-панель (пока без пароля)
        submitPasswordButton.addEventListener('click', () => {
             // В реальном приложении здесь должна быть проверка пароля.
             // Для этой демонстрации мы пропускаем этот шаг.
             showPage('admin_page');
        });

    </script>
</body>
</html>
